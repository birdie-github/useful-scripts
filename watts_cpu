#! /bin/bash

#----------------------------------------------------------------------
# Description: show CPU package power consumption
# Author: Artem S. Tashkinov
# Created at: 2019-09-04 14:17:52
#             2020-05-17 21:55:38 - output GPU wattage as well
#             2022-04-14 09:24:31 - disable GPU wattage, don't show emoji for console
#
# Copyright (c) 2019-2022 Artem S. Tashkinov  All rights reserved.
#
#----------------------------------------------------------------------

test ! -e /dev/cpu/0/msr && echo "MSR module not loaded. Exiting" && exit 1
test ! -r /dev/cpu/0/msr && echo "No permissions to read MSR. Exiting" && exit 2

interval=1
test -n "$1" && interval=$1
# only show emoji for a graphical session
test "$TERM" = "dumb" && echo -n " ⚙️"
turbostat --quiet --num_iterations 1 --interval "$interval" --show PkgWatt --Summary | tail -1 | tr -d '\n'
echo -n "W"

#sensors amdgpu-pci-0900 2>/dev/null | awk '/power/{print " 📀" int($2) "W"}'
